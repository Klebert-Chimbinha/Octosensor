//Deixa a fita de Led Respirar atraves da medição de Millis
#include <FastLED.h>

#define NUM_LEDS 30
#define LED_PIN 5
#define LED_TYPE    WS2812

unsigned long int respira = 0;
int r = 0;
int e = NUM_LEDS - 1;
int estado = 1;

CRGB leds[NUM_LEDS];

CRGBPalette16 currentPalette;
TBlendType    currentBlending;

void setup () {
  FastLED.addLeds<LED_TYPE, LED_PIN, GRB>(leds, NUM_LEDS);
  FastLED.setBrightness(250);
  
  currentPalette = RainbowColors_p;
  currentBlending = LINEARBLEND;
  }

void loop() {
 //int proximo = map(analogRead(A0),1023, 0, 1000, 10);
//if(proximo <= 1000){
  //estado = 1;
//}
  if(estado == 0){
  Respirando(50, 50);
  }
  if(estado == 1){
  Piscalerta(100,100);
}
if(estado == 2){
  //trigged(proximo, proximo*0.7);
  trigged(50,50);
}
}
void Respirando( int inspira, int expira) {
  if(r < NUM_LEDS){
    if(millis() - respira >= inspira){
      Arcoiris(r);
      blur1d(leds, NUM_LEDS, 10);
      FastLED.show();
      respira += inspira;
      r += 1;
      }
    }
    if(r == NUM_LEDS){
      if(millis() - respira >= expira){
        leds[e] = CRGB::Black;
        //blur1d(leds, NUM_LEDS, 15);
        fadeToBlackBy(leds, NUM_LEDS, 24);
        FastLED.show();
        respira += expira;
        e -= 1;
        }
      }
      if(r == NUM_LEDS and e == 0){
        r = 0;
        e = NUM_LEDS - 1;
      }
  } 
//Engatilhado
void Piscalerta( int inspira, int expira) {
  if(r < NUM_LEDS){
    if(millis() - respira >= inspira){
      fill_solid( leds, NUM_LEDS, CRGB::Red);
      FastLED.show();
      respira += inspira;
      r += 1;
      }
    if(millis() - respira >= expira){
        FastLED.clear();
        //fadeToBlackBy(leds, NUM_LEDS, 170);
        FastLED.show();
        respira += expira;
        e -= 1;
      }
    }
    if(r == NUM_LEDS){
      if(millis() - respira >= expira){
        fill_solid( leds, NUM_LEDS, CRGB::Red);
        FastLED.show();
        respira += expira;
        e -= 1;
      }
      }
      if(r == NUM_LEDS and e == 0){
      //FastLED.clear();
      fadeToBlackBy(leds, NUM_LEDS, 64);
        FastLED.show();
        e = NUM_LEDS - 1;
        r = 0;
        estado += 1;
      }
  }

void trigged(int inspira, int expira){
   if(r < NUM_LEDS){
    if(millis() - respira >= inspira){
      leds[r] = CRGB::Red;
      FastLED.show();
      respira += inspira;
      r += 1;
      }
    }
    if(r == NUM_LEDS){
      if(millis() - respira >= expira){
        leds[e] = CRGB::Black;
        FastLED.show();
        respira += expira;
        e -= 1;
        }
      }
      if(r == NUM_LEDS and e == 0){
        r = 0;
        e = NUM_LEDS - 1;
      }
  } 

void Arcoiris(int r ){
  int intervalo = NUM_LEDS/7;
  if(r + 1 <= intervalo){

    SetupArcoirisPalette();
    leds[r] = ColorFromPalette( currentPalette, 1000, 255, currentBlending);   //leds[r] = CRGB::Violet;
  }else if(r + 1 <= 2*intervalo){
    SetupArcoirisPalette();
leds[r] = ColorFromPalette( currentPalette, 7000, 255, currentBlending);    //leds[r] = CRGB::Indigo;
  }else if(r + 1 <= 3*intervalo){
    SetupArcoirisPalette();
leds[r] = ColorFromPalette( currentPalette, 6000, 255, currentBlending);      //leds[r] = CRGB::Cyan;
  }else if(r + 1 <= 4*intervalo){
    SetupArcoirisPalette();
leds[r] = ColorFromPalette( currentPalette, 5000, 255, currentBlending);     // leds[r] = CRGB::Green;
    }else if (r + 1 <= 5*intervalo){
      SetupArcoirisPalette();
leds[r] = ColorFromPalette( currentPalette, 4000, 255, currentBlending);     // leds[r] = CRGB::Yellow;
    }else if (r + 1 <= 6*intervalo){
      SetupArcoirisPalette();
leds[r] = ColorFromPalette( currentPalette, 3000, 255, currentBlending);      //leds[r] = CRGB::Orange;
      }else if(r + 1 <= 7*intervalo){
        SetupArcoirisPalette();
leds[r] = ColorFromPalette( currentPalette, 2000, 255, currentBlending);      //leds[r] = CRGB::Red;
     }else if( r + 1 >= 7*intervalo){
       SetupArcoirisPalette();
leds[r] = ColorFromPalette( currentPalette, 1000, 255, currentBlending);       //leds[r] = CRGB::Violet;
     }
}

// This function sets up a palette of purple and green stripes.
void SetupArcoirisPalette()
{
 CRGB::Indigo;
 CRGB::Cyan;
 CRGB::Green;
 CRGB::Yellow;
 CRGB::Orange;
 CRGB::Red;
  CRGB violet = CHSV( HUE_PINK, 255, 255);
  CRGB indigo = CHSV( HUE_PURPLE, 255, 255);
  CRGB purple = CHSV( HUE_PURPLE, 255, 255);
  CRGB cyan = CHSV( HUE_BLUE, 255, 255);
  CRGB green  = CHSV( HUE_GREEN, 255, 255);
  CRGB yellow = CHSV( HUE_YELLOW, 255, 255);
  CRGB orange = CHSV( HUE_ORANGE, 255, 255);
  CRGB red = CHSV( HUE_RED, 255, 255);
  CRGB black  = CRGB::Black;

  currentPalette = CRGBPalette16(
                     violet,  violet,  indigo,  indigo,
                     cyan, cyan, green,  green,
                     yellow,  yellow,  orange,  orange,
                     red, red, violet,  violet );
}
